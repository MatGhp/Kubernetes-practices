# =============================================================================
# Pods consuming a ConfigMap — 3 injection methods
# =============================================================================
# Requires: ConfigMap "app-config" from 08-config-map.yaml
#
# Method 1 — envFrom:  Inject ALL keys as env vars (bulk)
# Method 2 — env/valueFrom: Inject a SINGLE key as a named env var (selective)
# Method 3 — volume:   Mount keys as files inside the container
# =============================================================================


# -----------------------------------------------------------------------------
# Method 1: envFrom — inject ALL ConfigMap keys as environment variables
# -----------------------------------------------------------------------------
# Every key in the ConfigMap becomes an env var with the same name.
# e.g. APP_COLOR=blue, APP_MODE=production, APP_VERSION=1.0.0

apiVersion: v1
kind: Pod
metadata:
  name: simple-webapp-color
spec:
  containers:
    - name: simple-webapp-color-container
      image: mojtabaghp/kub-demo-simple-webapp-color:latest
      ports:
        - containerPort: 8080
      envFrom:
        - configMapRef:
            name: app-config       # Must match the ConfigMap metadata.name

---

# -----------------------------------------------------------------------------
# Method 2: env/valueFrom — inject a SINGLE key as an environment variable
# -----------------------------------------------------------------------------
# Only the specified key is injected. You control the env var name.
# Useful when you need just one value or want to rename the key.

apiVersion: v1
kind: Pod
metadata:
  name: simple-webapp-color-single-env
spec:
  containers:
    - name: simple-webapp-color-container
      image: mojtabaghp/kub-demo-simple-webapp-color:latest
      ports:
        - containerPort: 8080
      env:
        - name: APP_COLOR          # Env var name inside the container
          valueFrom:
            configMapKeyRef:
              name: app-config     # ConfigMap name
              key: APP_COLOR       # Key to read from the ConfigMap

---

# -----------------------------------------------------------------------------
# Method 3: volume — mount ConfigMap keys as files
# -----------------------------------------------------------------------------
# Each key becomes a file (filename = key, content = value).
# Mounted at the specified path inside the container.
# Updates to the ConfigMap are eventually reflected without pod restart.

apiVersion: v1
kind: Pod
metadata:
  name: simple-webapp-color-volume
spec:
  containers:
    - name: simple-webapp-color-container
      image: mojtabaghp/kub-demo-simple-webapp-color:latest
      ports:
        - containerPort: 8080
      volumeMounts:
        - name: config-volume
          mountPath: /etc/config   # Files: /etc/config/APP_COLOR, APP_MODE, etc.
          readOnly: true
  volumes:
    - name: config-volume
      configMap:
        name: app-config           # ConfigMap to mount
